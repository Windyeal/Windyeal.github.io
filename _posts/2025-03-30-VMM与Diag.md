---
layout:     post
title:      "VMM与Diag"
subtitle:   "SMT7_HiCBB库中VMM与DIAG的TML"
date:       2025-03-30
author:     "Hisilcon"
header-style: text
catalog: true
published: true

tags:
    - HiCBB
    - SMT7
    
---

# VminVmax+Diag

## 模式介绍

执行VminVmax测试后并在FunctionTest后输出scan result（抓取Fail Cycle）。

使用场景：诊断程序测试，RMA诊断(SCAN测试项，抓取Fail cycle）

## VminVmax部分参数

**VminVmax**：填入Vmm的扫描方式，默认为MostSearch，可选MostSearch、BoundarySearch。
**Vcoef**：填入扫描的level spec name，默认为Vcoef。
**SpecType**：选择扫描点的计算方式RelativeMode、AbsoluteMode、RelativeCoefMode， 默认为RelativeMode。
**Vcoef_End**：填入扫描的终止点，默认为1.2。
**Vcoef_Start**：填入扫描的起始点，默认为0.6。
**V_points**：填入初次扫描时需要扫描的点数，默认为11。
**V_detail_points**：填入细扫时需要扫描的点数，默认为11，如果初次扫描没有边界点则不会细扫。
**Vclamp_EN**：选择ON或OFF,默认为ON，使用Vclamp时选择为ON，否则选择OFF。
**Output**：选择log输出模式，默认为File+ReportUI，可选File、ReportUI、File+ReportUI、None。

## Diagnosis部分参数

**Diagnosis**：选择是否需要进行Diagnosis操作，默认为detail，可选detail、standard、simple。选择detail和standard时Functional测试后会根据测试结果进行扫描；选择simple时，在Functional测试结束后不会有Diagnosis动作。(建议用户选择detail，如果不使用diag功能，建议用户单选function模式进行测试)

deatil和standard模式在非hardfail时没有区别，在hardfail时所执行的Diag的point会有所不同

<font color=red>detail模式hardfail说明：</font>
>如果VMMhardfail，并且Diag为detail模式，则会抓取Primary点的diag数据，并基于primary点向左和向右分别下探抓取diag数据，下探的step和point数量由后面参数VminVmaxVstep和MarginPoints决定。
<font color=darkorange>detail模式下探点算法如下：
>primary左边和右边的下探点数量为MarginPoints除以2后取整，例如，设置的MarginPoints为3，则左右下探点数量为1(3/2取整)，加上Primary点一共抓三个点的diag，设置的MarginPoints为4，则左右下探点数量为2(4/2取整)，加上Primary点一共抓取五个点的diag</font>

<font color=red>standard模式hardfail说明：</font>
>如果VMMhardfail，并且Diag为standard模式，则只抓取primary点的Diag数据



**byModule**：选择是否要开启bymodule功能，默认为OFF，选择ON时开启
**FuncPort**：填入执行Diag的Port或pin。
**ResultLogPins**：填入Result输出的Port或Pin，PinName必须在FuncPort中存在。
**MaxFailsPerPin**：填入每一根Pin中最多输出的Fail数，默认为7000。（建议不要大于7000）
**Output**：选择diagnosis的log输出模式，默认为LargeFile，可选LargeFile、ReportUI、File+ReportUI、None。（diagnosis的Output选None时diag的数据不会输出到EDF中）
**CycleNumberPerLabel**：选择是否为多条label burst向量，默认为true，可选true、false。
**DpsVoutToLogValue**：填入需要输出Value的Dps Pin名称，默认为NA，如果不需要输出DPSpin的value则填NA。
**SpecToLogValue**：填入需要输出Value的Spec，默认为NA，如果不需要输出level或tming中的Spec Value 则填NA。（只支持为字母“T”开头或字母“V”开头的spec，例如:Vcoef、Tcoef）
**xmode**：填写该测试项pattern的Xmode模式，默认为1，可选1、2、3、4、5、6、7、8。
**Memory**：选择是否开启memory diag功能，默认为OFF，选ON时开启
**MarginPoints**：填写该测试中下探点的数量，默认为3。
**VminVmaxVstep**：填入该测试中下探时下探点的步进，默认为0.01。

**PowerMonitor**：选择ON或OFF，默认为OFF，使用PowerMonitor功能时选择ON，否则选择OFF。
**PreExecute**：选择ON或OFF，默认为OFF，使用PreExecute功能时选择ON，否则选择OFF。
**PostExecute**：选择ON或OFF，默认为OFF，使用PostExecute功能时选择ON，否则选择OFF。
**LogFile**：填入log文件的路径和文件名，默认为“report/hidigitallink_log”。

## 参数解释

**MostSearch和BoundarySearch说明**：
用户在填入 MostSearch 时 电压扫描由起始点 Vcoef_ Start 开始到终止点 Vcoef_ End 结
束，记录 粗扫 pa ss 区间最长 的电压范围 ，若有相同长的 pass 区间取最右边的 pass 区间 ，程序将在该电压范围的最小电压值处进入 Vmin 的 detail 扫描 在该电压范围的最大电压值处进入 Vmax 的 detail 扫描填入 Boundary Search 时， 电压扫描由起始点 Vcoef_ Start 开始到终止点 Vcoef_ End 结束，程序将在扫描范围中所有 pass 点的最小电压值处进入 Vmin 的 detail 扫描；在扫描 范围中所有 pass 点的最大电压值处进入 Vmax 的 detail 扫描。

**RelativeMode和Absolute说明**:
RelativeMode模式下，Vcoef_Start和Vcoef_End代表扫描的起始扫描系数和终止扫描系数，各个point的扫描系数由Vcoef_Start和Vcoef_End均等分计算得出，<font color = Red>各个point的值为spec值乘当前point的扫描系数</font>。
AbsoluteMode模式下，Vcoef_Start和Vcoef_End代表扫描的起始值和终止值，<font color = Red>各个point的值Vcoef_Start和Vcoef_End均等分计算得出</font>。

**参数Vclamp_EN**：Vclamp_EN用于在VminVmax扫描过程中保护电路，参数为ON时保护生效，系统内部会检查当前所扫spec基于扫描之前初始值的变化，如果小于初始值的0.5倍(含0.5)或者大于初始值的1.5倍(含1.5)系统会报错停止VminVmax扫描，<font color = Red>非特殊情况，使用时请开启Vclamp_EN</font>。

**Diag参数CycleNumberPerLabel**：为true时，failcycle number会以每个子pattern开始计算，为false时failcycle number会以总的pattern开始计算。需要注意：如果该测试项的pattern中pattern行数小于8行(不算循环)则此参数必须选择false，否则运行时会报错停止。

## 注意事项

**参数Vclamp_EN**: Vclamp_EN关闭时需要注意拉偏电压，防止电压过大将芯片击穿。

**手动调试VminVmax模块时注意事项**：
为了防止Autorun时在Vmin扫描过程中出现异常(没有restore)而导致后面的测试项以及芯片所扫描的值都出现偏移，我们在1.8.1版本的VminVmax功能中增加了防呆，第一次run VminVmax之前会获取当前所扫描 Level Equation中当前 spec里所扫描变量的值并作为初始值保存好。在后续的扫描中相同Level Equation spec 的初始值都会使用该值，防止某个测试项异常没restore之前的值而影响后面的测试项和芯片的扫描范围。

增加此防呆后对于用户调试来说需要注意:
用户在调试过程中如果之前已经扫了某个spec的VminVmax，后面修改该spec值后runVminVmax，需要在run之前点击Terminate Test Method Execution 清除之前的存的值。
